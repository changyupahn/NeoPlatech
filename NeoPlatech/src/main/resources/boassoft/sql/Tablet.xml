<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boassoft.mapper.TabletMapper">

   <sql id="pagingHeader">
    </sql>

    <sql id="pagingFooter">
        <if test="pageIdx != null and pageIdx != ''">      
          <if test="pageSize != null and pageSize != ''">        
                LIMIT ${pageLimit}, ${pageSize}
          </if>
       </if> 
    </sql>
    
     <sql id="getGoodsShipmentOutWhere">
          <if test="sDemandId != null and sDemandId != ''"> 		
    		AND A.DEMAND_ID = #{sDemandId}
        </if>    
        <if test="sLgPartNo!= null and sLgPartNo!= ''"> 		
    		AND A.LG_PART_NO = #{sLgPartNo!=}
        </if>
        <if test="sNeoLine != null and sNeoLine != ''"> 		
    		AND A.NEO_LINE = #{sLgLine}
        </if>
        <if test="sVendor != null and sVendor != ''"> 		
    		AND A.VENDOR = #{sVendor}
        </if>  
    </sql>
    
     <sql id="getPackingReceiptWhere">    
        <if test="final_vendor != null and final_vendor != ''">              
          AND A.FINAL_VENDOR LIKE concat('%',#{final_vendor},'%')
          </if>
          <if test="od_day != null and od_day != ''"> 	
          AND A.NEO_OD_DAY LIKE concat('%',#{od_day},'%')	
         </if>
         <if test="pkg_po_no != null and pkg_po_no != ''"> 	
          AND A.PKG_PO_NO LIKE concat('%',#{pkg_po_no},'%')	
         </if>
    </sql>
    
     <sql id="getPackingShipmentOutWhere">
        <if test="final_vendor != null and final_vendor != ''">              
          AND A.FINAL_VENDOR LIKE concat('%',#{final_vendor},'%')
          </if>
          <if test="od_day != null and od_day != ''"> 	
          AND A.NEO_OD_DAY LIKE concat('%',#{od_day},'%')	
         </if>
         <if test="pkg_po_no != null and pkg_po_no != ''"> 	
          AND A.PKG_PO_NO LIKE concat('%',#{pkg_po_no},'%')	
         </if> 
    </sql>
    
    <select id="getGoodsShipmentOutListXml" parameterType="cmap" resultType="goodsXml" >
        <include refid="pagingHeader"/>  
            SELECT 
             COALESCE(A.PT_OD_ID,' ') AS pt_od_id 
            , COALESCE(A.SUB_PT_OD_ID , ' ') AS sub_pt_od_id
            , COALESCE(A.DEMAND_ID, ' ') AS demand_id 
            , COALESCE(A.LG_PART_NO, ' ') AS lg_part_no  
            , COALESCE(A.LG_OD_QTY, ' ') AS lg_od_qty
            , COALESCE(A.PROD_TYPE, ' ') AS prod_type
            , COALESCE(A.NEO_LINE, ' ') AS neo_line
            , COALESCE(A.NEO_PLAN_KEY, ' ') AS neo_plan_key
            , COALESCE(A.SEND_TIME, ' ') AS send_time 
            , COALESCE(A.SENDING_PC_NAME,' ') AS sending_pc_name
            , COALESCE(A.GO_WITH,' ') AS go_with
            , COALESCE(A.RE_PRINT, ' ') AS re_print
            , COALESCE(A.SUB_PART_NO, ' ') AS sub_part_no
            , COALESCE(A.SUB_PART_DESC, ' ') AS sub_part_desc
            , COALESCE(A.VENDOR, ' ') AS vendor
            , COALESCE(A.BOM_QTY, ' ') AS bom_qty
            , COALESCE(A.SUB_UNIT, ' ') AS sub_unit  
            , COALESCE(A.SUB_SUM_QTY, ' ') AS sub_sum_qty
            , COALESCE(A.DEMAND_FLOOR, ' ') AS demand_floor
            , COALESCE(A.OSP, ' ') AS osp
           FROM RFID_IF_SUBPART_SENDLIST_ALL A		
          WHERE PT_OD_ID = #{ptOdId}   		 		
       ORDER BY A.PT_OD_ID, B.SUB_PART_NO
        <include refid="getGoodsShipmentOutWhere" /> 
         <if test="dataOrder != null and dataOrder != ''">        
        	ORDER BY ${dataOrder} ${dataOrderArrow}, A.PT_OD_ID, A.SUB_PART_NO      
        </if>
        <if test="dataOrder == null or dataOrder == ''">       
        	ORDER BY A.PT_OD_ID, A.SUB_PART_NO      
        </if> 
            <include refid="pagingFooter"/>         
    </select>
    
      <select id="getGoodsShipmentOutListXmlCnt" parameterType="cmap" resultType="int" >
    	 SELECT	COUNT(*)
        FROM 	RFID_IF_SUBPART_SENDLIST_ALL A 
          WHERE 1 = 1
		<include refid="getGoodsShipmentOutWhere"/>
    </select>     
    
    
    <update id="updateIGoodsShipmentOut" parameterType="cmap" >
    	<![CDATA[
    	  UPDATE RFID_IF_SUBPART_SEND_LIST_ALL
    	  SET 
    	     DEMAND_ID = #{demandId}
    	     , LG_PART_NO = #{lgPartNo}
    	     , LG_OD_QTY = #{lgOdQty}
    	     , PROD_TYPE = #{prodType}
    	     , NEO_LINE = #{neoLine}
    	     , NEO_PLAN_KEY = #{neoPlanKey}
    	     , SEND_TIME = #{sendTime}
    	     , SENDING_PC_NAME = #{sendingPcName}
    	     , GO_WITH = #{goWith}
    	     , RE_PRINT = #{rePrint}
    	     , SUB_PART_NO = #{subPartNo}
    	     , SUB_PART_DESC = #{subPartDesc}
    	     , VENDOR = #{vendor}
    	     , BOM_QTY = #{bomQty}
    	     , SUB_UNIT = #{subUnit}
    	     , SUB_SUM_QTY = #{subSumQty}
    	     , DEMAND_FLOOR = #{demandFloor}
    	     , A.OSP = #{osp}
    	     , RSLTDATE = #{rsltdate}
    	     , RSLTSTATE = #{rsltstate}
    	     , RSLT_USER_ID = #{rsltUserId}
    	     , READDATE = #{readdate}
    	     , READSTATE = #{readstate}
    	     , READ_USER_ID = #{read_user_id}
    	  WHERE 
    	   PT_OD_ID = #{ptOdId}
    	   AND SUB_PT_OD_ID = #{subPtOdId}
      ]]>
    </update>	    
    
   
      <select id="getPackingReceptListXml" parameterType="cmap" resultType="goodsXml" >
        <include refid="pagingHeader"/>
     <![CDATA[
	      SELECT COALESCE(A.OD_ID,' ')  AS od_id 
             , COALESCE(A.OD_QTY_ID,' ') AS od_qty_id
             , COALESCE(A.PKG_PO_NO,' ') AS pkg_po_no
             , COALESCE(A.DEMAND_ID,' ') AS demand_id
             , COALESCE(A.TOOL_NAME, ' ') AS tool_name
             , COALESCE(A.LG_PART_NO,' ') AS lg_part_no
             , COALESCE(A.LG_OD_QTY,0) AS lg_od_qty
             , COALESCE(A.LINE,' ') AS line
             , COALESCE(A.FINAL_VENDOR,' ') AS final_vendor
             , COALESCE(A.CLASS,' ') AS clazz
             , COALESCE(A.PART_NUMBER,' ') AS part_number
             , COALESCE(A.DESC,' ') AS desc
             , COALESCE(A.RESULT_QTY,0) AS result_qty
             , COALESCE(A.NEO_OD_TIME,' ') AS neo_od_time
             , COALESCE(A.NEO_OD_DAY,' ') AS neo_od_day
             , COALESCE(A.NEO_OD_QTY,0) AS neo_od_qty
             , COALESCE(A.QTY_ON_HAND,0) AS qty_on_hand
             , COALESCE(A.PRE_QTY_ON_HAND,0) AS pre_qty_on_hand 
        FROM RFID_IF_PACKING_WOSENDLIST_ODONLY A  
              WHERE 1 = 1 
          ]]>                 
          <include refid="getPackingReceiptWhere" />  
        GROUP BY A.FINAL_VENDOR
	    ORDER BY A.NEO_OD_DAY
	     <include refid="pagingFooter"/> 	           
      </select>
      
      <select id="getPackingReceptListXmlCnt" parameterType="cmap" resultType="int">   
      <![CDATA[      
         SELECT COUNT(*) FROM 
           (
                 SELECT A.OD_ID
             , A.OD_QTY_ID
             , A.PKG_PO_NO
             , A.DEMAND_ID
             , A.TOOL_NAME
             , A.LG_PART_NO
             , COALESCE(A.LG_OD_QTY,0) AS LG_OD_QTY
             , A.LINE
             , A.FINAL_VENDOR
             , A.CLASS
             , A.PART_NUMBER
             , A.DESC
             , COALESCE(A.RESULT_QTY,0) AS RESULT_QTY
             , A.NEO_OD_TIME
             , A.NEO_OD_DAY
             , COALESCE(A.NEO_OD_QTY,0) AS NEO_OD_QTY
             , COALESCE(A.QTY_ON_HAND,0) AS QTY_ON_HAND
             , COALESCE(A.PRE_QTY_ON_HAND,0) AS PRE_QTY_ON_HAND 
        FROM RFID_IF_PACKING_WOSENDLIST_ODONLY A  
              WHERE 1 = 1 
             ]]>            
            <include refid="getPackingReceiptWhere" />  
              GROUP BY A.FINAL_VENDOR
	         ORDER BY A.NEO_OD_DAY
          ) X	             
     </select>      
        
     
     <select id="getPackingShipmentOutListXml" parameterType="cmap" resultType="goodsXml">
       <include refid="pagingHeader"/>
       <![CDATA[
         SELECT 
           COALESCE(A.OD_ID,' ') AS od_id
           , COALESCE(A.DEMAND_ID,' ') AS demand_id
           , COALESCE(LEFT(A.IN_DATE,10),' ') AS in_date
           , COALESCE(A.LG_PART_NO,' ') AS lg_part_no
           , COALESCE(A.LG_OD_QTY,0) AS lg_od_qty
           , COALESCE(A.TOOL_NAME,' ') AS tool_name 
           , COALESCE(A.DRAW_NO,' ') AS draw_no
           , COALESCE(A.VENDOR,' ') AS vendor
           , COALESCE(A.SUB_PART_NAME,' ') AS sub_part_name
           , COALESCE(A.PART_NUMBER,' ') AS part_number
           , COALESCE(A.DESC,' ') AS desc
           , COALESCE(A.RESULT_QTY,0) AS result_qty
           , COALESCE(A.ROW_NUM,' ') AS row_num
           , COALESCE(A.CALCU_TRUE,' ') AS calcu_true
           , COALESCE(A.OD_QTY_ID,' ') AS od_qty_id
           , COALESCE(A.NEO_OD_TIME,' ') AS neo_od_time
           , COALESCE(LEFT(A.NEO_OD_DAY,10),' ') AS neo_od_day
           , COALESCE(A.NEO_OD_QTY,0) AS neo_od_qty
           , COALESCE(A.FINAL_VENDOR,' ') AS final_vendor
           FROM RFID_IF_PACKING_WOSENDLIST_ALL A  
               WHERE 1 = 1 
           ]]>            
            <include refid="getPackingShipmentOutWhere" />       		    		    		          
            <if test="dataOrder != null and dataOrder != ''">        
        	 ORDER BY ${dataOrder} ${dataOrderArrow},  ORDER A.OD_ID ASC      
             </if>
             <if test="dataOrder == null or dataOrder == ''">       
        	  ORDER BY A.DEMAND_ID DESC  
           </if>
        <include refid="pagingFooter"/>
    </select>
    
    <select id="getPackingShipmentOutListCnt" parameterType="cmap" resultType="int">    
      SELECT	COUNT(*)
        FROM 	RFID_IF_PACKING_WOSENDLIST_ALL A 
          WHERE 1 = 1
		     <include refid="getPackingShipmentOutWhere" />      
      </select>
      
      
     <select id="goodsShipmentDetailKitItemOutXml" parameterType="cmap" resultType="goodsXml"> 
      <include refid="pagingHeader"/>
       <![CDATA[
      SELECT    COALESCE(A.PT_OD_ID ,' ') AS pt_od_id
            , COALESCE(A.SUB_PT_OD_ID,' ') AS sub_pt_od_id 
            , COALESCE(A.DEMAND_ID,' ') AS demand_id 
            , COALESCE(A.LG_PART_NO,' ') AS lg_part_no
            , COALESCE(A.LG_OD_QTY,' ') AS lg_od_qty
            , COALESCE(A.PROD_TYPE,' ') AS prod_type
            , COALESCE(A.NEO_LINE,' ') AS neo_line
            , COALESCE(A.NEO_PLAN_KEY,' ') AS neo_plan_key            
            , COALESCE(LEFT(A.SEND_TIME,10),' ') AS send_time
            , COALESCE(A.SENDING_PC_NAME,' ') AS sending_pc_name
            , COALESCE(A.GO_WITH,' ') AS go_with
            , COALESCE(A.RE_PRINT,' ') As re_print
            , COALESCE(A.SUB_PART_NO,' ') AS sub_part_no
            , COALESCE(A.SUB_PART_DESC,' ') AS sub_part_desc
            , COALESCE(A.VENDOR,' ') AS vendor
            , COALESCE(A.BOM_QTY,0) AS bom_qty
            , COALESCE(A.SUB_UNIT,' ') AS sub_unit  
            , COALESCE(A.SUB_SUM_QTY,0) AS sub_sum_unit
            , COALESCE(A.DEMAND_FLOOR,' ') AS demand_floor
            , COALESCE(A.OSP,' ') AS osp
            , COALESCE(A.RSLTDATE,' ') AS rsltdate
            , COALESCE(A.RSLTSTATE,' ') AS rsltstate
            , COALESCE(A.RSLT_USER_NO,' ') AS rslt_user_no
            , COALESCE(A.READDATE,' ') AS readdate
            , COALESCE(A.READSTATE,' ') AS readstate
            , COALESCE(A.READ_USER_NO,' ') AS read_user_no 
            , COALESCE(A.QTY_ON_HAND,0) AS qty_on_hand
            , COALESCE(A.PRE_QTY_ON_HAND,0) AS pre_qty_on_hand			
        FROM RFID_IF_SUBPART_SENDLIST_ALL A
       WHERE A.PT_OD_ID  LIKE concat('%',#{ptOdId},'%')
		 AND A.DEMAND_FLOOR = 1			
       ORDER BY A.PT_OD_ID, A.SUB_PART_NO
      ]]>  
      <include refid="pagingFooter"/>
      </select>
      
      <select id="goodsShipmentDetailRefItemOutXml" parameterType="cmap" resultType="goodsXml"> 
        <include refid="pagingHeader"/>
       <![CDATA[
        SELECT   COALESCE(A.PT_OD_ID ,' ') AS pt_od_id
            , COALESCE(A.SUB_PT_OD_ID,' ') AS sub_pt_od_id 
            , COALESCE(A.DEMAND_ID,' ') AS demand_id 
            , COALESCE(A.LG_PART_NO,' ') AS lg_part_no
            , COALESCE(A.LG_OD_QTY,' ') AS lg_od_qty
            , COALESCE(A.PROD_TYPE,' ') AS prod_type
            , COALESCE(A.NEO_LINE,' ') AS neo_line
            , COALESCE(A.NEO_PLAN_KEY,' ') AS neo_plan_key            
            , COALESCE(LEFT(A.SEND_TIME,10),' ') AS send_time
            , COALESCE(A.SENDING_PC_NAME,' ') AS sending_pc_name
            , COALESCE(A.GO_WITH,' ') AS go_with
            , COALESCE(A.RE_PRINT,' ') As re_print
            , COALESCE(A.SUB_PART_NO,' ') AS sub_part_no
            , COALESCE(A.SUB_PART_DESC,' ') AS sub_part_desc
            , COALESCE(A.VENDOR,' ') AS vendor
            , COALESCE(A.BOM_QTY,0) AS bom_qty
            , COALESCE(A.SUB_UNIT,' ') AS sub_unit  
            , COALESCE(A.SUB_SUM_QTY,0) AS sub_sum_qty
            , COALESCE(A.DEMAND_FLOOR,' ') AS demand_floor
            , COALESCE(A.OSP,' ') AS osp
            , COALESCE(A.RSLTDATE,' ') AS rsltdate
            , COALESCE(A.RSLTSTATE,' ') AS rsltstate
            , COALESCE(A.RSLT_USER_NO,' ') AS rslt_user_no
            , COALESCE(A.READDATE,' ') AS readdate
            , COALESCE(A.READSTATE,' ') AS readstate
            , COALESCE(A.READ_USER_NO,' ') AS read_user_no 
            , COALESCE(A.QTY_ON_HAND,0) AS qty_on_hand
            , COALESCE(A.PRE_QTY_ON_HAND,0) AS pre_qty_on_hand	
        FROM RFID_IF_SUBPART_SENDLIST_ALL A
       WHERE A.PT_OD_ID  LIKE concat('%',#{ptOdId},'%')
		 AND DEMAND_FLOOR = 2			
       ORDER BY A.PT_OD_ID, A.SUB_PART_NO
       ]]>  
      <include refid="pagingFooter"/>
      </select>
      
      <select id="optionVendorListXml" parameterType="cmap" resultType="goodsXml"> 
      SELECT @rownum:=@rownum+1 AS row_num 
         , A.FINAL_VENDOR AS code
		 , A.FINAL_VENDOR AS code_name 
		 FROM RFID_IF_PACKING_WOSENDLIST_ALL A		 
		 , (SELECT @rownum:=0) TMP
         WHERE 1 = 1
         AND A.FINAL_VENDOR IS NOT NULL
         GROUP BY A.FINAL_VENDOR
		 ORDER BY ROW_NUM 
	  </select>	 
	   
</mapper> 