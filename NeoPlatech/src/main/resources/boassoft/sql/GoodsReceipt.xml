<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="boassoft.mapper.GoodsReceiptMapper">

   <sql id="pagingHeader">
    </sql>

    <sql id="pagingFooter">
        <if test="pageIdx != null and pageIdx != ''">      
          <if test="pageSize != null and pageSize != ''">        
                LIMIT ${pageLimit}, ${pageSize}
          </if>
       </if> 
    </sql>
    
     <sql id="getGoodsReceiptWhere">      
         <if test="sPrimKey != null and sPrimKey != ''"> 		
    		AND A.PRIM_KEY LIKE concat('%',#{sPrimKey},'%')
        </if>                
         <if test="sDemandId != null and sDemandId != ''"> 		
    		AND A.DEMAND_ID LIKE concat('%',#{sDemandId},'%')
        </if>    
        <if test="sModel != null and sModel != ''"> 		
    		AND A.MODEL LIKE concat('%',#{sModel},'%')
        </if>
        <if test="sLgLine != null and sLgLine != ''"> 		
    		AND A.LG_LINE LIKE concat('%',#{sLgLine},'%') 
        </if>
        <if test="sBuyer != null and sBuyer != ''"> 		
    		AND A.BUYER  LIKE concat('%',#{sBuyer},'%') 
        </if>
        <if test="sResinCore != null and sResinCore != ''">        	
    		AND A.RESIN_CORE LIKE concat('%',#{sResinCore},'%')    	
        </if>
         <if test="sTool != null and sTool != ''">        	
    		AND A.TOOL LIKE concat('%',#{sTool},'%')    	
        </if>
        <if test="sSuffix != null and sSuffix != ''">        	
    		AND A.SUFFIX LIKE concat('%',#{sSuffix},'%')    	
        </if>
         <if test="sPartNo != null and sPartNo != ''">        	
    		AND A.PART_NO LIKE concat('%',#{sPartNo},'%')    	
        </if>
        <if test="searchDtKeywordS != null and searchDtKeywordS != ''">     	    	
    		<choose>
            <when test="searchDtGubun == '1'">    	
			 AND A.LGE_DATE <![CDATA[ >= ]]> #{searchDtKeywordS}			
			</when>
			 <when test="searchDtGubun == '5'"> 			
			AND A.ENTER_DATE <![CDATA[ >= ]]> #{searchDtKeywordS}
			</when>
		   </choose>	
		</if>   					
		<if test="searchDtKeywordE != null and searchDtKeywordE != ''">     	    	
    	  <choose>
            <when test="searchDtGubun == '1'">  	
			AND A.LGE_DATE <![CDATA[ <= ]]> #{searchDtKeywordE}
			</when>			
			<when test="searchDtGubun == '5'">			
			AND A.ENTER_DATE <![CDATA[ <= ]]> #{searchDtKeywordE}
			</when>
		  </choose>
		</if>  
     </sql>
     
     <select id="getGoodsReceiptList" parameterType="cmap" resultType="cmap">
          <include refid="pagingHeader"/>
              SELECT A.OD_KEY
               , A.PRIM_KEY
               , A.DEMAND_ID
               , A.BUYER
               , A.LG_LINE
               , A.MODEL
               , A.FIX_DAY
               , A.PART_NO
               , A.ITEM
               , A.RESIN_CORE
               , COALESCE(A.PLAN_QTY,0) AS PLAN_QTY
               , COALESCE(A.INJECTION_QTY,0) AS INJECTION_QTY
               , COALESCE(A.QTY,0) AS QTY
               , COALESCE(A.RESIDUAL_QTY,0) AS RESIDUAL_QTY
             FROM RFID_IF_LG_NEW_ORDER_PLAN_LIST A  
              WHERE 1 = 1  
               <include refid="getGoodsReceiptWhere" />  
               <if test="histOrder != null and histOrder != ''"> 
		        <choose>
                 <when test="histOrder == 'ASC'">			
				  ORDER A.OD_KEY ASC			
			     </when>
			     <when test="histOrder == 'DESC'">					
				  ORDER BY A.OD_KEY DESC			
		         </when>
		         </choose>  
		    </if> 
		    <if test="histOrder == null and histOrder == ''"> 		
			ORDER BY A.PRIM_KEY DESC		
        </if>
        <include refid="pagingFooter"/>
     </select>  
     
      <select id="getGoodsReceiptListCnt" parameterType="cmap" resultType="int">
      SELECT	COUNT(*)
        FROM 	RFID_If_LG_NEW_ORDER_PLAN_LIST A 
          WHERE 1 = 1
		     <include refid="getGoodsReceiptWhere" />      
      </select>
      
      <select id="getOptionVendorList" parameterType="cmap" resultType="cmap">
         SELECT @rownum:=@rownum+1 AS ROWNUM 
         , A.VENDOR AS CODE
		 , A.VENDOR AS CODE_NAME FROM RFID_IF_SUBPART_WOSENDLIST_ODONLY A
		 , (SELECT @rownum:=0) TMP
         WHERE 1 = 1
         GROUP BY A.VENDOR
		 ORDER BY ROWNUM           
       </select>
       
       <select id="getOptionItemList" parameterType="cmap" resultType="cmap">
       SELECT  @rownum:=@rownum+1 ROWNUM 
         , A.SUB_PART_NAME CODE
		 , A.SUB_PART_NAME CODE_NAME FROM rfid_if_subpart_wosendlist_odonly A
         , (SELECT @rownum:=0) TMP
          WHERE 1 = 1
          AND A.VENDOR LIKE concat('%',#{paramSltValue},'%')
          GROUP BY A.VENDOR
		  ORDER BY ROWNUM       
       </select>
       
       <select id="getOptionPNoList" parameterType="cmap" resultType="cmap">
        SELECT  @rownum:=@rownum+1 ROWNUM
          , A.SUB_PART_NAME AS CODE 
          , A.SUB_PART_NAME CODE_NAME
		   FROM rfid_if_subpart_wosendlist_odonly A
		  , (SELECT @rownum:=0) TMP
           WHERE 1 = 1
           AND VENDOR LIKE concat('%',#{codeId},'%')
           AND SUB_PART_NAME LIKE concat('%',#{sltValue},'%')	
           GROUP BY A.VENDOR
	       ORDER BY ROWNUM
	   </select>
	   
	   <select id="getGoodsReceiptDetailList" parameterType="cmap" resultType="cmap">
	    <include refid="pagingHeader"/>
	    <![CDATA[
	    SELECT 
                  A.OD_ID
                 , A.DEMAND_ID
                 , A.LGE_DATE
                 , A.NEO_DATE
                 , A.GAP_DAY
                 , A.LG_LINE
                 , A.TOOL
                 , A.M_PART_NO                 
                 , COALESCE(A.PLAN_QTY,0) AS PLAN_QTY 
                 , A.LGM_PART_NAME
                 , A.SUB_PART_NO
                 , A.SUB_PART_NAME
                 , COALESCE(A.BOM_QTY,0) AS BOM_QTY
                 , COALESCE(A.SUM_QTY,0) AS SUM_QTY                  
                 , CASE WHEN COALESCE(A.SUM_QTY_CNG,0) > 0 THEN COALESCE(A.SUM_QTY_CNG,0)
                   ELSE  COALESCE(A.SUM_QTY,0) END AS SUM_QTY_CNG
                 , A.UNIT
                 , A.VENDOR
                 , A.OSP
                 , A.OUT_PLACE
                 , A.CHK_DAY
                 , A.IN_DATE 
                 , COALESCE(A.QTY_ON_HAND,0) AS QTY_ON_HAND
                 , COALESCE(A.PRE_QTY_ON_HAND,0) AS PRE_QTY_ON_HAND 
                FROM RFID_IF_SUBPART_WOSENDLIST_ODONLY A
                WHERE 1 = 1      
          ]]>                 
          <if test="vendor != null and vendor != ''">              
          AND VENDOR LIKE concat('%',#{vendor},'%')
          </if>
          <if test="subPartName != null and subPartName != ''"> 	
          AND SUB_PART_NAME LIKE concat('%',#{subPartName},'%')	
         </if>
        GROUP BY A.VENDOR
	    ORDER BY A.LGE_DATE
	     <include refid="pagingFooter"/> 	   
	   </select>
       
     <select id="getGoodsReceiptDetailListCnt" parameterType="cmap" resultType="int">   
      <![CDATA[      
         SELECT COUNT(*) FROM 
           (
               SELECT 
                  A.OD_ID
                 , A.DEMAND_ID
                 , A.LGE_DATE
                 , A.NEO_DATE
                 , A.GAP_DAY
                 , A.LG_LINE
                 , A.TOOL
                 , A.M_PART_NO                 
                 , COALESCE(A.PLAN_QTY,0) AS PLAN_QTY 
                 , A.LGM_PART_NAME
                 , A.SUB_PART_NO
                 , A.SUB_PART_NAME
                 , COALESCE(A.BOM_QTY,0) AS BOM_QTY
                 , COALESCE(A.SUM_QTY,0) AS SUM_QTY                  
                 , CASE WHEN COALESCE(A.SUM_QTY_CNG,0) > 0 THEN COALESCE(A.SUM_QTY_CNG,0)
                   ELSE  COALESCE(A.SUM_QTY,0) END AS SUM_QTY_CNG
                 , A.UNIT
                 , A.VENDOR
                 , A.OSP
                 , A.OUT_PLACE
                 , A.CHK_DAY
                 , A.IN_DATE 
                 , COALESCE(A.QTY_ON_HAND,0) AS QTY_ON_HAND
                 , COALESCE(A.PRE_QTY_ON_HAND,0) AS PRE_QTY_ON_HAND                
                FROM RFID_IF_SUBPART_WOSENDLIST_ODONLY A
                WHERE 1 = 1        
             ]]>            
               <if test="vendor != null and vendor != ''"> 			 
                 AND VENDOR LIKE concat('%',#{vendor},'%')
               </if>
               <if test="subPartName != null and subPartName != ''"> 	
                 AND SUB_PART_NAME LIKE concat('%',#{subPartName},'%')	          
                </if>   
              GROUP BY A.VENDOR
	         ORDER BY A.LGE_DATE
          ) X	             
     </select>  
            
</mapper>

